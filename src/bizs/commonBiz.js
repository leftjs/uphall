// Generated by CoffeeScript 1.10.0
(function() {
  var authAndSetUserInfo, customError, db;

  db = require('./../libs/db');

  customError = function(status, msg) {
    var err;
    err = new Error();
    err.status = status;
    err.message = msg;
    return err;
  };

  authAndSetUserInfo = function(req, res, next) {
    var token;
    token = req.header('x-token');
    if (!token) {
      return next(customError(401, '未传入token'));
    }
    return db.users.findOne({
      token: token,
      expiredTime: {
        $gt: Date.now()
      }
    }, function(err, user) {
      if (err) {
        return next(err);
      }
      if (user) {
        req.userInfo = user;
        return next();
      } else {
        return next(customError(401, '授权失败,请检查你的token'));
      }
    });
  };

  module.exports = {
    authAndSetUserInfo: authAndSetUserInfo,
    customError: customError
  };

}).call(this);

//# sourceMappingURL=commonBiz.js.map
